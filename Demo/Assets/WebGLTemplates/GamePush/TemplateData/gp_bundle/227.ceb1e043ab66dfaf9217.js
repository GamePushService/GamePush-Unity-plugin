(self.webpackChunkgame_score_sdk=self.webpackChunkgame_score_sdk||[]).push([[227],{227:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(3607),n=i(7),s=i(5959);var o,a,h,d=i(8866),c=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function a(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((r=r.apply(e,t||[])).next())}))},u=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};class l{constructor(e,t,i){this.gp=e,this.sdk=i,o.add(this),this.userId="",this.username="",this.avatar="",this.isAuthorizedAtPlatform=!0,a.set(this,void 0),function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?n.call(e,i):n?n.value=i:t.set(e,i)}(this,a,t,"f")}get hasCredetials(){return!!this.userId}getPlayerAuthInfo(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,{id:this.sdk.userId}}))}getPlayerContext(){return c(this,void 0,void 0,(function*(){const{id:e}=(yield this.getPlayerAuthInfo())||{};return{platformData:{},key:e||""}}))}loginPlayer(e,t={isAuthModal:!1}){return c(this,void 0,void 0,(function*(){if(!t.isAuthModal&&this.userId)return this.getPlayer();const e=(0,r._X)(),i="cordova"in window&&!!window.cordova.InAppBrowser,l=function(e){return{key:"_gs_config",config:btoa(JSON.stringify(e))}}({apiConfig:u(this,a,"f").getOptions(),env:i?"cordova":"web"}),E=`https://gs.eponesh.com/sdk/static/pages/xsolla/auth.html?${l.key}=${l.config}`,f={isExternal:!0,tag:"xsollaAuth",frameOrigin:new URL(E).origin,frameSrc:E},v=new s.Z(f),_=e=>v.receiveMessage(e);window.addEventListener("message",_,!1),v.waitResponse("requestXsollaInitConfig").then((()=>{var e;v.send({type:"xsollaInitConfig",payload:{projectId:(null===(e=this.gp.platform.config.authConfig.xsollaConfig)||void 0===e?void 0:e.loginProjectId)||"",preferredLocale:this.gp.locale}})})),v.waitResponse(n.W9.REQUEST_FOR_EXTERNAL_DISPLAY).then((e=>{v.setOptions(e),v.connect()})),v.waitResponse("xsollaAuthReady").then((t=>c(this,void 0,void 0,(function*(){this.userId=t.userId,this.username=t.username||"",this.avatar=t.avatar||"",yield u(this,o,"m",h).call(this,t.token).catch(e.abort),e.done()})))),v.waitResponse("xsollaAuthFailed").then((t=>{e.abort("incorrect_token")})),v.waitResponse("openOAuthUrl").then((({url:t,closeButton:r})=>{if(i){const e=window.cordova.InAppBrowser.open(t,"_blank",`location=no,${r}`),i=new URL(E).origin;let n=!1;e.addEventListener("loadstart",(({url:t})=>{const r=new URL(t);if(r.origin===i){const t=r.searchParams.get("token")||"";n=!!t,v.send({type:"outerHandleAuthToken",payload:{token:t}}),e.close()}})),e.addEventListener("loadstop",(()=>{e.insertCSS({code:"html{height: 100vh;} body{height: calc(100vh - 45px);} .ext-widget_f{bottom:50px !important;}"})})),e.addEventListener("exit",(()=>c(this,void 0,void 0,(function*(){yield(0,d.Z)(500),n||v.send({type:"outerOAuthUrlClosed",payload:{}})}))))}else e.abort("incorrect_environment")})),yield this.gp.loadOverlay(),this.gp.overlay.showIframe({src:E,title:"login.title"}).catch(e.abort);const p=yield e.ready.then((()=>this.getPlayer())).catch((()=>({id:"",name:"",photoSmall:"",photoMedium:"",photoLarge:""})));return window.removeEventListener("message",_),yield this.gp.overlay.close(),p}))}logoutPlayer(){return c(this,void 0,void 0,(function*(){yield this.sdk.ready;const{success:e}=yield this.gp._services.playerService.logoutPlayer();return e&&(this.userId="",this.username="",this.avatar=""),e}))}getPlayer(){return c(this,void 0,void 0,(function*(){return{id:this.userId,name:this.username,photoSmall:this.avatar,photoMedium:this.avatar,photoLarge:this.avatar}}))}publishRecord(e){}isPlatformAvatar(){return!1}setCredentials(e){this.userId=e}}a=new WeakMap,o=new WeakSet,h=function(e){return c(this,void 0,void 0,(function*(){const t=(0,r._X)();return this.gp._services.playerService.loginPlayer({token:e}).then((({success:e})=>{t.done(e)})).catch((e=>{t.abort(e)})),t.ready}))}},7:(e,t,i)=>{"use strict";i.d(t,{W9:()=>r,ie:()=>n,ZP:()=>u});var r,n,s,o=i(8293),a=i(6558),h=i(6390),d=i(209),c=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function a(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((r=r.apply(e,t||[])).next())}))};!function(e){e.REQUEST_TO_LOGIN="RequestToLogin",e.REQUEST_TO_PROVIDE_ADS_CONFIG="ProvideAdsConfig",e.REQUEST_FOR_EXTERNAL_DISPLAY="RequestForExternalDisplay",e.REQUEST_TO_SHOW_FULLSCREEN="RequestToShowFullscreen",e.REQUEST_TO_SHOW_PRELOADER="RequestToShowPreloader",e.REQUEST_TO_SHOW_STICKY="RequestToShowSticky",e.REQUEST_TO_CLOSE_STICKY="RequestToCloseSticky",e.REQUEST_TO_REFRESH_STICKY="RequestToRefreshSticky",e.REQUEST_TO_SHOW_REWARDED_VIDEO="RequestToShowRewardedVideo"}(r||(r={})),function(e){e.EXTERNAL_ADS_SDK_READY="ExternalAdsSdkReady",e.EXTERNAL_SDK_READY_RESPONSE="ExternalSdkReadyResponse",e.FIRST_PROVIDE_DATA="FirstProvideData",e.PROVIDE_PLAYER="ProvidePlayer",e.PLAYER_LOGOUT="PlayerLogout",e.PLAYER_LOGIN="PlayerLogin",e.EXTERNAL_PLAYER_LOGIN="ExternalPlayerLogin",e.PROVIDE_ADS_CONFIG="ProvideAdsConfig",e.SHOW_FULLSCREEN="ShowFullscreen",e.SHOW_PRELOADER="ShowPreloader",e.SHOW_STICKY="ShowSticky",e.REFRESH_STICKY="RefreshSticky",e.CLOSE_STICKY="CloseSticky",e.SHOW_REWARDED="ShowRewarded"}(n||(n={})),function(e){e.AD_NOT_AVAILABLE="AD is not available or does not exist",e.AD_ALREADY_SHOWN="Ad is already shown",e.BANNER_NOT_EXIST="Banner does not exist",e.REWARDED_SUCCESS="Reward was given",e.REWARDED_FAILED="Reward failed",e.SHOW_AD_SUCCESS="Show AD success",e.AD_WAS_CLOSED="Ad was closed",e.INTERNAL_ERROR="Internal error"}(s||(s={}));class u{constructor(e,t){this.gp=e,this.sdk=t,this.userId="",this.gameUrl="";try{const e=new URL(window.location.href).searchParams.get("_gpParams");e&&(this.shareParams=d.Z.parse(e))}catch(e){a.kg.error(e)}}init(){return c(this,void 0,void 0,(function*(){const e=(0,o._)();return this.ready=e.ready,e.done(this),e.ready}))}get appUrl(){return this.gameUrl?this.gameUrl:(0,h.T)()}getPlayer(){return c(this,void 0,void 0,(function*(){return{id:this.userId,name:"",photoSmall:"",photoMedium:"",photoLarge:""}}))}loginPlayer(){return c(this,void 0,void 0,(function*(){return this.getPlayer()}))}purchase(e){return c(this,void 0,void 0,(function*(){return this.sdk.makePurchase(e)}))}subscribe(e,t){return c(this,void 0,void 0,(function*(){if(!this.gp.player.isLoggedIn)throw new Error("subscribe failed");return 0==(null==t?void 0:t.subscribed)&&Date.parse(null==t?void 0:t.expiredAt)>Date.parse(this.gp.serverTime)?this.sdk.resumeSubscription(t):this.sdk.makePurchase(e)}))}unsubscribe(e){return c(this,void 0,void 0,(function*(){const t=(0,o._)(),i=yield this.sdk.unsubscribe(e);return i.purchase.subscribed?t.abort("unsubscribe failed"):t.done({subscription_id:i.purchase._id}),t.ready}))}addShareParamsToUrl(e,t){return d.Z.addShareParamsToUrl(e,{_gpParams:d.Z.stringify(t)})}makeShareUrl(e){return this.addShareParamsToUrl(this.gp.app.url,e)}getShareParam(e){return this.shareParams?this.shareParams[e]:""}}},5959:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var r,n,s,o,a,h,d,c,u=i(8293),l=i(8690),E=i(7),f=i(5239),v=i(6388),_=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function a(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((r=r.apply(e,t||[])).next())}))},p=function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},S=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};class R extends v.Z{constructor(e){super(),this.options=e,r.add(this),n.set(this,"*"),s.set(this,void 0),this.isConnected=!1,this.firstPingIntervalId=null,p(this,n,e.frameOrigin,"f"),p(this,s,e.isExternal,"f"),S(this,r,"m",o).call(this)}setOptions(e){p(this,n,e.frameOrigin,"f"),this.options.frameOrigin=e.frameOrigin,this.options.frameSrc=e.frameSrc}send(e){return _(this,void 0,void 0,(function*(){return S(this,r,"m",c).call(this,e)}))}receiveMessage(e){return _(this,void 0,void 0,(function*(){yield S(this,r,"m",d).call(this,e)}))}sendAsync(e){return _(this,void 0,void 0,(function*(){return yield S(this,r,"m",c).call(this,e),this.waitResponse(e.type)}))}connect(e={}){return _(this,void 0,void 0,(function*(){S(this,s,"f")?(this.isConnected=!0,yield this.send({type:E.ie.EXTERNAL_SDK_READY_RESPONSE,payload:{parentOrigin:location.origin,payload:e}})):yield this.waitResponse(E.ie.EXTERNAL_SDK_READY_RESPONSE)}))}waitResponse(e){return _(this,void 0,void 0,(function*(){const t=(0,u._)();return this.once(e,t.done),t.ready}))}}n=new WeakMap,s=new WeakMap,r=new WeakSet,o=function(){return _(this,void 0,void 0,(function*(){this.options.isExternal||(this.firstPingIntervalId=window.setInterval((()=>S(this,r,"m",h).call(this)),10))}))},a=function(e,t="*",i){return _(this,void 0,void 0,(function*(){const r=(0,u._)();try{const n=document.querySelector(`[src^="${i||""}"]`),o=JSON.parse(e),a=(new Date).toISOString(),h=`${o.type}-${a}`,d=(0,f.S)(h),c=Object.assign(Object.assign({},o),{hash:d,timestamp:a,tag:this.options.tag});S(this,s,"f")?n&&n.contentWindow.postMessage(c,t):window.parent.postMessage(c,t),r.done(!0)}catch(e){r.abort(e)}return r.ready}))},h=function(){return _(this,void 0,void 0,(function*(){yield S(this,r,"m",c).call(this,{type:E.W9.REQUEST_FOR_EXTERNAL_DISPLAY,payload:{frameOrigin:location.origin,frameSrc:location.href}})}))},d=function(e){return _(this,void 0,void 0,(function*(){if(!(0,l.Z5)(e))return;const{type:t,payload:i,tag:r}=e.data;if(!r||r===this.options.tag)switch(t){case E.ie.EXTERNAL_SDK_READY_RESPONSE:S(this,n,"f")||p(this,n,i.parentOrigin,"f"),clearInterval(this.firstPingIntervalId),this.firstPingIntervalId=null,this.isConnected=!0,this._events.emit(E.ie.EXTERNAL_SDK_READY_RESPONSE,i);break;case E.ie.EXTERNAL_ADS_SDK_READY:this._events.emit(E.ie.EXTERNAL_ADS_SDK_READY,i);break;case E.ie.FIRST_PROVIDE_DATA:this._events.emit(E.ie.FIRST_PROVIDE_DATA,i);break;case E.ie.PROVIDE_PLAYER:this._events.emit(E.ie.PROVIDE_PLAYER,i);break;case E.ie.PLAYER_LOGOUT:this._events.emit(E.ie.PLAYER_LOGOUT,i);break;case E.ie.PLAYER_LOGIN:this._events.emit(E.ie.PLAYER_LOGIN,i);break;case E.ie.EXTERNAL_PLAYER_LOGIN:this._events.emit(E.ie.EXTERNAL_PLAYER_LOGIN,i);break;case E.ie.SHOW_FULLSCREEN:this._events.emit(E.ie.SHOW_FULLSCREEN,i);break;case E.ie.SHOW_PRELOADER:this._events.emit(E.ie.SHOW_PRELOADER,i);break;case E.ie.SHOW_REWARDED:this._events.emit(E.ie.SHOW_REWARDED,i);break;case E.ie.SHOW_STICKY:this._events.emit(E.ie.SHOW_STICKY,i);break;case E.ie.CLOSE_STICKY:this._events.emit(E.ie.CLOSE_STICKY,i);break;default:this._events.emit(t,i||e.data.params,e.data)}}))},c=function(e){return _(this,void 0,void 0,(function*(){const t=(0,l.au)(e),{frameSrc:i}=this.options;yield S(this,r,"m",a).call(this,t,S(this,n,"f"),i||null)}))}},8690:(e,t,i)=>{"use strict";i.d(t,{Z5:()=>o,au:()=>a});var r,n=i(180),s=i(5239);function o(e){var t;const i=e.data;if(!i||"object"!=typeof i)return!1;if(null===(t=i.type)||void 0===t?void 0:t.startsWith("@xsolla-login/sdk"))return!0;if(!Object.values(r).every((e=>i.hasOwnProperty(e)&&void 0!==i[e])))return!1;const{timestamp:n,hash:o,type:a}=i,h=`${a}-${n}`;return(0,s.S)(h)===o}function a(e){return JSON.stringify(e)}i(8276),function(e){e.TYPE="type",e.TIMESTAMP="timestamp",e.HASH="hash",e.PAYLOAD="payload"}(r||(r={})),Object.values(n.$)}}]);
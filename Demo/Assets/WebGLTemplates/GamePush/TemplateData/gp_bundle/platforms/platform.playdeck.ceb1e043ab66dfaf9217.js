(self.webpackChunkgame_score_sdk=self.webpackChunkgame_score_sdk||[]).push([[2767],{3716:t=>{"use strict";var e=Array.prototype.slice;function i(t){var i,r=e.call(arguments,1);switch(r.length){case 1:throw new Error("Not enough forms");case 2:i=t>1?r[1]:r[0];break;default:i=r[n(t)]}return i.replace(/%d/g,t)}function r(t){return t>1e6?2:(t>1e3&&t<1e6&&/000$/.test(t)&&(t/=1e3),t%10==1&&t%100!=11||/1000$/.test(t.toString())?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)}function n(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2}t.exports=i,t.exports.noun=i,t.exports.verb=function(t){var i=e.call(arguments,1),n=i[r(t)];return n.replace(/%d/g,t)}},4340:(t,e,i)=>{"use strict";i.d(e,{D:()=>r});const r=()=>Promise.resolve({success:!1,rating:0,error:""})},5572:(t,e,i)=>{"use strict";i.d(e,{VK:()=>r,yl:()=>n});const r={success:!0,payload:{}},n={success:!1,payload:{}}},2712:(t,e,i)=>{"use strict";i.d(e,{aD:()=>d,FU:()=>v,hc:()=>p});const r=(t,e)=>({type:t,getLink:e}),n=r("facebook",(t=>`//www.facebook.com/sharer/sharer.php?u=${t.url}`)),s=r("whatsapp",(t=>`//api.whatsapp.com/send?text=${t.text}%20${t.url}`)),a=r("telegram",(t=>`//t.me/share/url?url=${t.url}&text=${t.text}`)),o=r("vkontakte",(t=>`//vk.com/share.php?url=${t.url}&title=${t.text}&image=${t.image}`)),u=r("twitter",(t=>`//twitter.com/share?text=${t.text}&url=${t.url}`)),c=r("odnoklassniki",(t=>`//connect.ok.ru/offer?url=${t.url}&title=${t.text}&imageUrl=${t.image}`)),l=r("viber",(t=>`viber://forward?text=${t.text}%20${t.url}`)),h=r("moymir",(t=>`//connect.mail.ru/share?url=${t.url}&title=${t.text}&image_url=${t.image}`)),d=[s,a,o,c,l,h],v=[n,u,a,s,l],p=[n,u,a,s,l,o,c,h]},4954:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>x});var r=i(6558),n=i(8293),s=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}))};class a{constructor(t){this.gp=t,this.gameUrl="",this.shareParams={},this.isUserAccountAvailable=!1,this._isAuthorized=!1,this.parent=window.parent,this.transactions={},this.isPaymentPending=!1,window.addEventListener("message",this.recieveMessage.bind(this))}requestGameUrl(){return s(this,void 0,void 0,(function*(){try{this.initializeTransaction("getShareLinkTransaction"),this.gameUrl=yield this.executePostMessage("getShareLink","getShareLinkTransaction",{})}catch(t){r.kg.error(t)}}))}get appUrl(){return this.gameUrl||this.requestGameUrl(),this.gameUrl}initializeTransaction(t){const e=(0,n._)();return this.transactions[t]=e,e}completeTransaction(t,e){var i;null===(i=this.transactions[t])||void 0===i||i.done(e)}abortTransaction(t,e){var i;null===(i=this.transactions[t])||void 0===i||i.abort(e)}executePostMessage(t,e,i){return s(this,void 0,void 0,(function*(){return e&&this.initializeTransaction(e),this.parent.postMessage({playdeck:{method:t,value:i}},"*"),e?this.transactions[e].ready:Promise.resolve()}))}recieveMessage({data:t}){const e=null==t?void 0:t.playdeck;if(!e)return;const i={getToken:()=>{var t;return this.completeTransaction("tokenTransaction",null===(t=e.value)||void 0===t?void 0:t.token)},getShareLink:()=>this.completeTransaction("getShareLinkTransaction",e.value),getUserProfile:()=>{var t,i;this.completeTransaction("authorizedTransaction",!!(null===(t=e.value)||void 0===t?void 0:t.telegramId)),this.completeTransaction("userProfileTransaction",e.value),this.completeTransaction("loginPlayerTransaction",e.value),this.shareParams=Object.assign({},null===(i=e.value)||void 0===i?void 0:i.params)},rewardedAd:()=>this.completeTransaction("rewardedTransaction",!0),errAd:()=>this.abortTransaction("rewardedTransaction","Show Rewarded error"),skipAd:()=>this.completeTransaction("rewardedTransaction",!1),notFoundAd:()=>this.abortTransaction("rewardedTransaction","Ad not available or does not exist"),requestPayment:()=>{this.completeTransaction("requestPaymentTransaction",e.value)},invoiceClosed:()=>{var t,i,r,n;switch(null===(t=e.value)||void 0===t?void 0:t.status){case"paid":this.completeTransaction("purchaseTransaction",e.value);break;case"canceled":this.abortTransaction("purchaseTransaction",null===(i=e.value)||void 0===i?void 0:i.status);break;case"failed":this.abortTransaction("purchaseTransaction",null===(r=e.value)||void 0===r?void 0:r.status);break;case"pending":this.isPaymentPending=!0;break;default:this.abortTransaction("purchaseTransaction",null===(n=e.value)||void 0===n?void 0:n.status)}},getPaymentInfo:()=>{this.completeTransaction("getPaymentInfoTransaction",e.value)}};e.method in i&&i[e.method]()}init(){return s(this,void 0,void 0,(function*(){const t=this.initializeTransaction("readyTransaction");return this.initializeTransaction("authorizedTransaction"),this.initializeTransaction("getShareLinkTransaction"),this.gp.on("gameStart",(()=>this.loading())),yield this.executePostMessage("getUserProfile"),this._isAuthorized=yield this.transactions.authorizedTransaction.ready,this.requestGameUrl(),this.gp.on("gameplayStart",(()=>this.executePostMessage("sendAnalyticNewSession"))),t.done(this),t.ready}))}getPlayer(){return s(this,void 0,void 0,(function*(){this.initializeTransaction("userProfileTransaction"),yield this.ready,this.executePostMessage("getUserProfile");const t=yield this.transactions.userProfileTransaction.ready;return this.formatPlayerProfile(t)}))}loginPlayer(){return s(this,void 0,void 0,(function*(){this.initializeTransaction("loginPlayerTransaction"),yield this.ready;const t=yield this.executePostMessage("getUserProfile","loginPlayerTransaction");return this._isAuthorized=!!t.telegramId,this.formatPlayerProfile(t)}))}getToken(){return s(this,void 0,void 0,(function*(){return yield this.ready,yield this.executePostMessage("getToken","tokenTransaction")}))}showRewardedVideo(){return s(this,void 0,void 0,(function*(){return yield this.ready,yield this.executePostMessage("showAd","rewardedTransaction")}))}addShareParamsToUrl(t,e){try{const i=new URL(t),r=btoa(JSON.stringify({game:{key:"",raw:{}}})),n=JSON.parse(atob(i.searchParams.get("startapp")||r));return n.game.raw=Object.assign({},e),i.searchParams.set("startapp",btoa(JSON.stringify(n))),i.href}catch(e){return r.kg.error(`Failed to add share params to URL: ${e}`),t}}makeShareUrl(t={}){return this.addShareParamsToUrl(this.gameUrl,t)}getShareParam(t){return this.shareParams?this.shareParams[t]:""}purchase(t){var e,i;return s(this,void 0,void 0,(function*(){this.initializeTransaction("requestPaymentTransaction");const r=this.initializeTransaction("purchaseTransaction"),n=yield this.gp._services.paymentsService.purchase({payload:{},id:t.id}),{url:s}=yield this.executePostMessage("requestPayment","requestPaymentTransaction",{amount:t.price,description:t.description,externalId:(null===(e=null==n?void 0:n.purchase)||void 0===e?void 0:e._id)||"",photoUrl:(null==t?void 0:t.iconSmall)||""});if(this.openTelegramLink(s),this.isPaymentPending){this.initializeTransaction("getPaymentInfoTransaction");const{intervalId:t,paymentInfo:e}=this.pollPaymentInfo((null===(i=null==n?void 0:n.purchase)||void 0===i?void 0:i._id)||"",3e3);e&&(null==e?void 0:e.paid)&&(clearInterval(t),this.completeTransaction("purchaseTransaction",!0))}return r.ready}))}pollPaymentInfo(t,e){let i=0,r=null;return{intervalId:setInterval((()=>s(this,void 0,void 0,(function*(){i++>=5?(clearInterval(e),this.abortTransaction("purchaseTransaction","Purchase attempts exceeded"),this.isPaymentPending=!1):(this.executePostMessage("getPaymentInfo",null,{externalId:t}),r=yield this.transactions.getPaymentInfoTransaction.ready)}))),e),paymentInfo:r}}openTelegramLink(t){this.parent.postMessage({playdeck:{method:"openTelegramLink",value:t}},"*")}loading(){this.executePostMessage("loading"),setTimeout((()=>this.executePostMessage("loading",null,100)),1e3)}formatPlayerProfile(t){return{id:(null==t?void 0:t.telegramId)||"",name:(null==t?void 0:t.username)||"",photoSmall:(null==t?void 0:t.avatar)||"",photoMedium:(null==t?void 0:t.avatar)||"",photoLarge:(null==t?void 0:t.avatar)||""}}}var o=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}))};class u{constructor(t){this.sdk=t,this.hasCredetials=!1,this.userId=""}get isAuthorizedAtPlatform(){return this.sdk._isAuthorized}getPlayerAuthInfo(){return o(this,void 0,void 0,(function*(){const t=yield this.sdk.getToken();if("string"!=typeof t||3!==t.split(".").length)throw"playdeck returned bad token";const e=JSON.parse(atob(t.split(".")[1]));return this.userId=e.sub,this.hasCredetials=Boolean(this.userId),{id:this.userId,token:t}}))}getPlayerContext(){return o(this,void 0,void 0,(function*(){const{id:t,token:e}=yield this.getPlayerAuthInfo();return{platformData:{token:e},key:t}}))}loginPlayer(){return o(this,void 0,void 0,(function*(){return this.sdk.loginPlayer()}))}logoutPlayer(){return o(this,void 0,void 0,(function*(){return!1}))}getPlayer(){return o(this,void 0,void 0,(function*(){return this.sdk.getPlayer()}))}publishRecord(t){}isPlatformAvatar(){return!1}setCredentials(t){}}var c=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}))};class l{constructor(t){this.sdk=t,this.stickyBannerConfig={isOverlapping:!1,height:0},this.canShowFullscreenBeforeGamePlay=!0,this.needToLeaveFullscreenBeforeAds=!1,this.isRewardedAvailable=!0,this.isStickyAvailable=!1,this.isFullscreenAvailable=!1,this.isPreloaderAvailable=!1}showPreloader(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,!1}))}showFullscreen(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,!1}))}showRewardedVideo(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.showRewardedVideo()}))}showSticky(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,!1}))}refreshSticky(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,!1}))}closeSticky(){return c(this,void 0,void 0,(function*(){}))}}var h=i(2712),d=i(5942),v=i(5572),p=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}))};class m{constructor(t){this.sdk=t,this.hasIntegratedAuth=!1,this.isExternalLinksAllowed=!0,this.isSecretCodeAuthAvailable=!1,this._hasAuthModal=!1,this.isLogoutAvailable=!1,this.type=d.z.PLAYDECK,this.socialNetworks=h.FU,this.isSupportsImageUploading=!1,this.hasAccountLinkingFeature=!1,this.isSupportsRemoteVariables=!1,this.isSupportsCloudSaves=!1,this.hasIntegratedAuth=this.sdk.isUserAccountAvailable}getSDK(){return this.sdk}getNativeSDK(){return this.getSDK()}requestPermissions(){return p(this,void 0,void 0,(function*(){return v.VK}))}uploadImage(){return null}getVariables(){return p(this,void 0,void 0,(function*(){return{}}))}}class f{constructor(t){this.sdk=t,this.isSupportsShare=!0,this.isSupportsNativeShare=!1,this.isSupportsNativePosts=!1,this.isSupportsNativeInvite=!1,this.isSupportsNativeCommunityJoin=!1,this.canJoinCommunity=!0,this.isSupportShareParams=!0}get shareParams(){return this.sdk.shareParams}share(t){return Promise.resolve(!1)}post(t){return Promise.resolve(!1)}invite(t){return Promise.resolve(!1)}getCommunityLink(t){return t}joinCommunity(){return Promise.resolve(!1)}addShareParamsToUrl(t,e){return this.sdk.addShareParamsToUrl(t,e)}makeShareUrl(t){return this.sdk.makeShareUrl(t)}getShareParam(t){return this.sdk.getShareParam(t)}}var y=i(3716),g=i.n(y),P=i(9503),k=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}))};const T={[P.Uo.RU]:t=>g()(t,"Звезда","Звезды","Звезд"),[P.Uo.EN]:t=>g()(t,"Star","Stars","Stars")};class w{constructor(t,e){this.gp=t,this.sdk=e,this.isSupportsSubscriptions=!1,this.isOneTimeSubscription=!0,this.isSupportsPayments=!0,this.isServerValidation=!0,this.isNeedAuthorizeBeforePurchase=!1}mapProducts(t,e){return k(this,void 0,void 0,(function*(){return e.map((e=>Object.assign(Object.assign({},e),{currencySymbol:(T[t.language]||T[P.Uo.EN])(e.price),currency:"XTR"})))}))}consumeAllExpired(t,e,i){return k(this,void 0,void 0,(function*(){}))}fetchPurchases(){return k(this,void 0,void 0,(function*(){return{payload:{},purchases:[]}}))}purchase(t){return k(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.purchase(t)}))}consume(t){return k(this,void 0,void 0,(function*(){return{}}))}subscribe(t,e){return k(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.purchase(t)}))}unsubscribe(t,e){return k(this,void 0,void 0,(function*(){return{}}))}}var S=i(4340);class b{constructor(t){this.sdk=t,this.canAddShortcut=!1,this.canRequestReview=!1,this.isAlreadyReviewed=!1}addShortcut(){return t=this,e=void 0,r=function*(){return!1},new((i=void 0)||(i=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}u((r=r.apply(t,e||[])).next())}));var t,e,i,r}requestReview(){return(0,S.D)()}requestGameUrl(){return this.sdk.requestGameUrl()}}function x(t){return e=this,i=void 0,n=function*(){const e=new a(t.gp),[,,i]=yield Promise.all([e.init(),t.setupStorage([]),t.fetchConfig()]),r=new u(e);return{adsAdapter:new l(e),appAdapter:new b(e),playerAdapter:r,platformAdapter:new m(e),socialsAdapter:new f(e),paymentsAdapter:new w(t.gp,e),projectConfig:i}},new((r=void 0)||(r=Promise))((function(t,s){function a(t){try{u(n.next(t))}catch(t){s(t)}}function o(t){try{u(n.throw(t))}catch(t){s(t)}}function u(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(a,o)}u((n=n.apply(e,i||[])).next())}));var e,i,r,n}}}]);